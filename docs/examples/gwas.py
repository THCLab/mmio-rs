import m2io_tmp as mmio
import polars as pd
from pprint import pprint

oca_bundle = '{"bundle":{"v":"OCAS20JSON0027f3_","digest":"EDVTSYKu4g7pNfLm_XY62mTFpQrMLHW5B6ilYLaainpz","capture_base":{"digest":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"capture_base/2.0.0","attributes":{"age":"Numeric","alanine_aminotransferase":"Numeric","albumin":"Numeric","alcohol_intake":"Text","alkaline_phosphatase":"Numeric","aspartate_aminotransferase":"Numeric","asthma":"Boolean","atrial_fibrillation":"Boolean","bmi":"Numeric","c_reactive_protein":"Numeric","calcium":"Numeric","chronic_kidney_disease":"Boolean","chronic_obstructive_pulmonary_disease":"Boolean","creatinine":"Numeric","creatinine_in_urine":"Numeric","dbp":"Numeric","diabetes":"Boolean","dietary_habits":"Text","eGFR":"Numeric","education":"Text","ethnicity":"Text","ffmi":"Numeric","fmi":"Numeric","gamma_glutamyl_transferase":"Numeric","gender":"Text","glycated_haemoglobin":"Numeric","haemoglobin":"Numeric","hdl_cholesterol":"Numeric","height":"Numeric","hypercholesterolemia":"Boolean","hypertension":"Boolean","ldl_cholesterol":"Numeric","mean_corpuscular_haemoglobin":"Numeric","mean_corpuscular_haemoglobin_concentration":"Numeric","p_duration":"Numeric","pathfinder_site":"Text","patient_id":"Text","peripheral_artery_disease":"Boolean","physical_activity_IPAQ_score":"Numeric","platelet_count":"Numeric","potassium_in_urine":"Numeric","pp_interval":"Numeric","previous_myocardial_infarction":"Boolean","pulse_rate":"Numeric","qrs_duration":"Numeric","qt_interval":"Numeric","qtc_interval":"Numeric","r_axis":"Numeric","red_blood_cell_distribution_width":"Numeric","sbp":"Numeric","sex":"Text","sleep_duration":"Numeric","smoking_history":"Text","sodium_in_urine":"Numeric","stroke":"Boolean","t_axis":"Numeric","time_using_computer":"Numeric","time_watching_TV":"Numeric","total_bilirubin":"Numeric","townsend_deprivation_index":"Numeric","triglycerides":"Numeric","urate":"Numeric","urea":"Numeric","ventricular_rate":"Numeric","vitamin_d":"Numeric","waist_height_ratio":"Numeric","waist_hip_ratio":"Numeric","white_blood_cell_count":"Numeric"}},"overlays":{"conformance":{"digest":"ED9GliPqCKFpHi2TeGvU187CbUT2SfdilZ_3M-EvXODF","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/conformance/2.0.0","attribute_conformance":{"age":"M","asthma":"O","atrial_fibrillation":"O","chronic_kidney_disease":"O","chronic_obstructive_pulmonary_disease":"O","diabetes":"O","ethnicity":"M","gender":"O","height":"M","hypercholesterolemia":"O","hypertension":"O","pathfinder_site":"M","patient_id":"M","peripheral_artery_disease":"O","previous_myocardial_infarction":"O","pulse_rate":"M","sbp":"M","sex":"M","smoking_history":"O","stroke":"O","waist_height_ratio":"O","waist_hip_ratio":"O"}},"entry":[{"digest":"ED64bxUFVHPQWHJm-sbTaA9BDCgWbYitJZDCVl2jNNAq","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/entry/2.0.0","language":"eng","attribute_entries":{"alcohol_intake":{"Heavy drinker":"Heavy drinker","Light drinker":"Light drinker","Moderate drinker":"Moderate drinker","Non-drinker":"Non-drinker"},"asthma":{"No":"No","Yes":"Yes"},"atrial_fibrillation":{"No":"No","Yes":"Yes"},"chronic_kidney_disease":{"No":"No","Yes":"Yes"},"chronic_obstructive_pulmonary_disease":{"No":"No","Yes":"Yes"},"diabetes":{"No":"No","Yes":"Yes"},"education":{"No formal education":"No formal education","Postgraduate education":"Postgraduate education","Primary education":"Primary education","Secondary education":"Secondary education","Tertiary education":"Tertiary education"},"ethnicity":{"African":"African","Asian":"Asian","Black":"Black","Caucasian":"Caucasian","Hispanic":"Hispanic","Mixed":"Mixed","Other":"Other","White":"White"},"gender":{"F":"Female","M":"Male","O":"Other"},"hypercholesterolemia":{"No":"No","Yes":"Yes"},"hypertension":{"No":"No","Yes":"Yes"},"peripheral_artery_disease":{"No":"No","Yes":"Yes"},"previous_myocardial_infarction":{"No":"No","Yes":"Yes"},"sex":{"F":"Female","M":"Male"},"smoking_history":{"Current smoker":"Current smoker","Former smoker":"Former smoker","Never smoked":"Never smoked"},"stroke":{"No":"No","Yes":"Yes"}}},{"digest":"EDS2-ny7-ztUUIbP4rceEGCWxvAnJ1BEm9DpbRSj4H5b","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/entry/2.0.0","language":"epo","attribute_entries":{"alcohol_intake":{"Heavy drinker":"Grava trinkanto","Light drinker":"Luma trinkanto","Moderate drinker":"Modera trinkanto","Non-drinker":"Neniam trinkanto"},"asthma":{"No":"Ne","Yes":"Jes"},"atrial_fibrillation":{"No":"Ne","Yes":"Jes"},"chronic_kidney_disease":{"No":"Ne","Yes":"Jes"},"chronic_obstructive_pulmonary_disease":{"No":"Ne","Yes":"Jes"},"diabetes":{"No":"Ne","Yes":"Jes"},"education":{"No formal education":"Neniu formala edukado","Postgraduate education":"Postdiploma edukado","Primary education":"Unua edukado","Secondary education":"Dua edukado","Tertiary education":"Tria edukado"},"gender":{"F":"Virino","M":"Viro","O":"Alia"},"hypercholesterolemia":{"No":"Ne","Yes":"Jes"},"hypertension":{"No":"Ne","Yes":"Jes"},"peripheral_artery_disease":{"No":"Ne","Yes":"Jes"},"previous_myocardial_infarction":{"No":"Ne","Yes":"Jes"},"sex":{"F":"Virino","M":"Viro"},"smoking_history":{"Current smoker":"Aktuale fumanta","Former smoker":"Iam fumis","Never smoked":"Neniam fumis"},"stroke":{"No":"Ne","Yes":"Jes"}}}],"entry_code":{"digest":"ENwF4leMVcCbbuWIscFb6Ae8NMYBoIO3H2iUkCgDcQmM","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/entry_code/2.0.0","attribute_entry_codes":{"alcohol_intake":["Heavy drinker","Light drinker","Moderate drinker","Non-drinker"],"asthma":["No","Yes"],"atrial_fibrillation":["No","Yes"],"chronic_kidney_disease":["No","Yes"],"chronic_obstructive_pulmonary_disease":["No","Yes"],"diabetes":["No","Yes"],"education":["No formal education","Postgraduate education","Primary education","Secondary education","Tertiary education"],"ethnicity":["African","Asian","Black","Caucasian","Hispanic","Mixed","Other","White"],"gender":["F","M","O"],"hypercholesterolemia":["No","Yes"],"hypertension":["No","Yes"],"peripheral_artery_disease":["No","Yes"],"previous_myocardial_infarction":["No","Yes"],"sex":["F","M"],"smoking_history":["Current smoker","Former smoker","Never smoked"],"stroke":["No","Yes"]}},"format":{"digest":"EOWhoJCMozzBQ-J2y4nAO3QF35koZEi_uh_x2_r-h2Yu","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/format/2.0.0","attribute_formats":{"alanine_aminotransferase":"U/L","albumin":"g/dL","alkaline_phosphatase":"U/L","aspartate_aminotransferase":"U/L","bmi":"kg/m2","c_reactive_protein":"mg/L","calcium":"mg/day","creatinine":"mg/dL","creatinine_in_urine":"mg/dL","dbp":"mmHg","dietary_habits":"Dietary Habits","eGFR":"mL/min/1.73m2","ffmi":"kg/m2","fmi":"kg/m2","gamma_glutamyl_transferase":"U/L","glycated_haemoglobin":"mmol/mol","haemoglobin":"g/dL","hdl_cholesterol":"mg/dL","height":"cm","ldl_cholesterol":"mg/dL","mean_corpuscular_haemoglobin":"pg","mean_corpuscular_haemoglobin_concentration":"g/dL","p_duration":"ms","physical_activity_IPAQ_score":"MET-min/week","platelet_count":"10^9/L","potassium_in_urine":"mmol/L","pp_interval":"ms","pulse_rate":"bpm","qrs_duration":"ms","qt_interval":"ms","qtc_interval":"ms","r_axis":"degrees","red_blood_cell_distribution_width":"%","sbp":"mmHg","sleep_duration":"hours/night","sodium_in_urine":"mmol/L","t_axis":"degrees","time_using_computer":"hours/week","time_watching_TV":"hours/week","total_bilirubin":"mg/dL","triglycerides":"mg/dL","urate":"mg/dL","urea":"mg/dL","ventricular_rate":"bpm","vitamin_d":"ng/mL","white_blood_cell_count":"10^9/L"}},"label":[{"digest":"EBZp7jABxT874QqC-WBltDRcFlNsPDL5P2jNY8OoUZgc","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/label/2.0.0","language":"eng","attribute_labels":{"age":"Age (years)","asthma":"Asthma","atrial_fibrillation":"Atrial Fibrillation","bmi":"Body Mass Index (kg/m2)","chronic_kidney_disease":"Chronic Kidney Disease","chronic_obstructive_pulmonary_disease":"Chronic Obstructive Pulmonary Disease","dbp":"Diastolic Blood Pressure (mmHg)","diabetes":"Diabetes","education":"Education Level","ethnicity":"Ethnicity","ffmi":"Fat Free Mass Index (kg/m2)","fmi":"Fat Mass Index (kg/m2)","gender":"Gender","height":"Height (cm)","hypercholesterolemia":"Hypercholesterolemia","hypertension":"Hypertension","pathfinder_site":"Pathfinder site","patient_id":"Patient ID","peripheral_artery_disease":"Peripheral Artery Disease","previous_myocardial_infarction":"Previous Myocardial Infarction","pulse_rate":"Pulse Rate (bpm)","sbp":"Systolic Blood Pressure (mmHg)","sex":"Sex","smoking_history":"Smoking History","stroke":"Stroke","waist_height_ratio":"Waist-Height Ratio","waist_hip_ratio":"Waist-Hip Ratio"}},{"digest":"EPznCkVlIEI2j5i5qVXTeO6sNpcutrGurpHMjbUoAtQM","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/label/2.0.0","language":"epo","attribute_labels":{"age":"Aĝo (jaroj)","asthma":"Astmo","atrial_fibrillation":"Atriuma Fibrilacio","chronic_kidney_disease":"Kronika Rena Malsano","chronic_obstructive_pulmonary_disease":"Kronika Obstruktiva Pulma Malsano","diabetes":"Diabeto","education":"Edukado","ethnicity":"Etneco","gender":"Genro","height":"Alteco (m)","hypercholesterolemia":"Hiperĥolesterolemio","hypertension":"Hipertensio","peripheral_artery_disease":"Perifera Arteria Malsano","previous_myocardial_infarction":"Antaŭa Miokardia Infarkto","pulse_rate":"Pulsofrekvenco (bpm)","sbp":"Sistola Sanga Premo (mmHg)","sex":"Sekso","smoking_history":"Fumada Historio","stroke":"Apopleksio","waist_height_ratio":"Talia-Alteca Proporcio","waist_hip_ratio":"Talia-Koksa Proporcio"}}],"meta":[{"digest":"EDYLMczAirMmwddmd0nA9Vpsv1sgvR8H8yPd_Q0ScH1P","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/meta/2.0.0","language":"epo","description":"Skemo por kardiovaskulaj variabloj en genome-wide association studies.","name":"Kardiovaskulaj GWAS-Variabloj"},{"digest":"EIn-YD2yxpPB1DVhVqp1S2sWfjHfazDqPDc3UcnHNF4r","capture_base":"EC1sxKmAj-54cRPEZ_i2FqPPdVA4R8m2QdeEUj28apQ6","type":"overlay/meta/2.0.0","language":"eng","description":"Schema for cardiovascular-related variables in genome-wide association studies.","name":"Cardiovascular GWAS Variables"}]}},"meta":{"alias":"FIRE@7.0"}}'

mmio_str = '{"version":"0.1","id":"EI-TaIVg2tmtXMdjAlogb5OnmaAsdhHVnGqfhDMk4mTM","data":[{"id":"EA_zIBLGGyzCo5ywVZz5asrtktgxR2dLRiegv6-wmC89","modality_said":"EK0GaxzGUPg54gPrUVOE1BkmZyRJXWXjGmQCeZCjSNeQ","modality_type":"Image","media_type":"image/png","oca_bundle":{"type":"Bundle","value":{"digest":"EHJ58dssK7HxXJjATIdMjXy2aoJpZRH7cIai5NXPQaZD","capture_base":{"digest":"EHZSMO2EFsXy8r5XogQ381-VmOiTUQYjV3WNkBfWYaCH","type":"capture_base/2.0.0","attributes":{"first_name":"Text","hgt":"Numeric","last_name":"Text","wgt":"Numeric"}},"overlays":{"character_encoding":{"digest":"EEDz_xTwN9P8BCZcU33OfFrO_lWIry9Jl1srE9leGbwF","capture_base":"EHZSMO2EFsXy8r5XogQ381-VmOiTUQYjV3WNkBfWYaCH","type":"overlay/character_encoding/2.0.0","attribute_character_encoding":{"first_name":"utf-8","hgt":"utf-8","last_name":"utf-8","wgt":"utf-8"}},"meta":[{"digest":"EP9iNoIrLu9w3YAMNW8FLWj5sP6VpOIoTIvDeC_6kvK0","capture_base":"EHZSMO2EFsXy8r5XogQ381-VmOiTUQYjV3WNkBfWYaCH","type":"overlay/meta/2.0.0","language":"eng","description":"Standard 1 Patient BMI","name":"Patient BMI"}]}}}}]}'

# # Semantic interop
mmio_s2 = mmio.open(mmio_str)

# next step: Create new mmio

modalities = mmio_s2.modalities

# Iterate and print info
for mod in modalities:
    print(f"Modality ID: {mod.id.value}")
    print(f"Modality Type: {mod.modality_type}")
    print(f"Media Type: {mod.media_type}")

    if mod.oca_bundle.is_reference():
        print("  Semantic: Reference")
    elif mod.oca_bundle.is_bundle():
        print("  Semantic: Bundle")
        print(mod.oca_bundle)
    else:
        print("  Semantic: Unknown")


print(mmio_s2)


# Load MMIO
# Extract modalities (each modality is identified by a unique SAID)
# Extract semantic of the modality

# print(mmio_s2.data.records)
# print(mmio_s2.serialize())
#
# tabular_data_1 = pd.read_csv('./docs/examples/assets/fake_0.csv')
# mmio_s2.ingest(tabular_data_1)
# tabular_data_2 = pd.read_csv('./docs/examples/assets/fake_1.csv')
# mmio_s2.ingest(tabular_data_2)
# print(mmio_s2.data.records)
#
# transformed_data = mmio_s2.data.to({"standard": "Standard1@1.0"})
# print("\n\ntransformed data:\n{0}".format(transformed_data.records))
# # pprint(mmio_fake.events)
